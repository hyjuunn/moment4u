{"ast":null,"code":"var _jsxFileName = \"/Users/hyunjunekim/Documents/GitHub/moment4u/src/pages/CreateDiaryPage.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport '../styles/global.css';\nimport { useNavigate } from 'react-router-dom';\nimport StoryGrid from '../components/StoryGrid';\nimport { uploadImages, getAllStories, deleteStory, getImages, analyzeImagesSequentially, generateStory, createStory } from '../services/api';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst CreateDiaryPage = () => {\n  _s();\n  const navigate = useNavigate();\n  const [showPopup, setShowPopup] = useState(false);\n  const [isFading, setIsFading] = useState(false);\n  const [stories, setStories] = useState([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadedImages, setUploadedImages] = useState([]);\n  const [combinedDescription, setCombinedDescription] = useState('');\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [isGeneratingStory, setIsGeneratingStory] = useState(false);\n  const [generatedStory, setGeneratedStory] = useState(null);\n  const fileInputRef = useRef(null);\n  const [isDeleteMode, setIsDeleteMode] = useState(false);\n  const [selectedStories, setSelectedStories] = useState(new Set());\n  const [isMobile, setIsMobile] = useState(false);\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.matchMedia('(max-width: 768px)').matches);\n    };\n\n    // Initial check\n    checkMobile();\n\n    // Add listener for window resize\n    const mediaQuery = window.matchMedia('(max-width: 768px)');\n    mediaQuery.addListener(checkMobile);\n\n    // Cleanup\n    return () => mediaQuery.removeListener(checkMobile);\n  }, []);\n  useEffect(() => {\n    fetchStories();\n    fetchImages();\n  }, []);\n  const fetchStories = async () => {\n    try {\n      const fetchedStories = await getAllStories();\n      setStories(fetchedStories);\n    } catch (error) {\n      console.error('Failed to fetch stories:', error);\n    }\n  };\n  const fetchImages = async () => {\n    try {\n      const images = await getImages();\n      setUploadedImages(images);\n      console.log('Fetched images:', images);\n    } catch (error) {\n      console.error('Failed to fetch images:', error);\n    }\n  };\n  useEffect(() => {\n    let fadeTimer;\n    let hideTimer;\n    if (showPopup) {\n      // Start fade out after 1.7 seconds\n      fadeTimer = setTimeout(() => {\n        setIsFading(true);\n      }, 1700);\n\n      // Hide popup after fade out animation (2 seconds + 0.3 seconds for fade out)\n      hideTimer = setTimeout(() => {\n        setShowPopup(false);\n        setIsFading(false);\n      }, 2000);\n    }\n    return () => {\n      clearTimeout(fadeTimer);\n      clearTimeout(hideTimer);\n    };\n  }, [showPopup]);\n  const handleCreateStory = () => {\n    var _fileInputRef$current;\n    (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n  };\n  const handleFileSelect = async event => {\n    const files = event.target.files;\n    if (!files || files.length === 0) return;\n    try {\n      setIsUploading(true);\n      const uploadedImages = await uploadImages(Array.from(files));\n      console.log('Successfully uploaded images:', uploadedImages);\n      setUploadedImages(uploadedImages);\n\n      // Start analyzing images\n      setIsAnalyzing(true);\n      const description = await analyzeImagesSequentially(uploadedImages);\n      setCombinedDescription(description);\n      setIsAnalyzing(false);\n\n      // Generate story\n      setIsGeneratingStory(true);\n      const storyResult = await generateStory(description);\n      setGeneratedStory(storyResult);\n      setIsGeneratingStory(false);\n\n      // Save the story\n      if (storyResult.title && storyResult.story && uploadedImages.length > 0) {\n        const imageUrls = uploadedImages.map(img => img.image_path);\n        const storyId = uploadedImages[0].story_id;\n        await createStory(storyResult.title, storyResult.story, imageUrls, storyId);\n        console.log('Story saved successfully!');\n      }\n    } catch (error) {\n      console.error('Failed to generate story:', error);\n      // Handle error appropriately\n    } finally {\n      setIsUploading(false);\n      if (event.target) {\n        event.target.value = ''; // Reset file input\n      }\n    }\n  };\n  const handleDeleteStory = async storyId => {\n    try {\n      await deleteStory(storyId);\n      setStories(prev => prev.filter(story => story.id !== storyId));\n    } catch (error) {\n      console.error('Failed to delete story:', error);\n      alert('Failed to delete story. Please try again.');\n    }\n  };\n  const handleStorySelect = storyId => {\n    setSelectedStories(prev => {\n      const newSelected = new Set(prev);\n      if (newSelected.has(storyId)) {\n        newSelected.delete(storyId);\n      } else {\n        newSelected.add(storyId);\n      }\n      return newSelected;\n    });\n  };\n  const handleDeleteClick = () => {\n    if (isDeleteMode) {\n      // If already in delete mode, perform deletion\n      if (selectedStories.size > 0) {\n        const confirmDelete = window.confirm(`Are you sure you want to delete ${selectedStories.size} selected ${selectedStories.size === 1 ? 'story' : 'stories'}?`);\n        if (confirmDelete) {\n          selectedStories.forEach(async storyId => {\n            try {\n              await deleteStory(storyId);\n              // After successful deletion, you might want to refresh the stories list\n              // or remove the deleted story from the current list\n            } catch (error) {\n              console.error('Error deleting story:', error);\n              alert('Failed to delete story. Please try again.');\n            }\n          });\n          setSelectedStories(new Set());\n        }\n      }\n      setIsDeleteMode(false);\n    } else {\n      // Enter delete mode\n      setIsDeleteMode(true);\n    }\n  };\n  const renderDescription = () => {\n    if (isAnalyzing) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Analyzing images...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 14\n      }, this);\n    }\n    if (isGeneratingStory) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Generating story...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 14\n      }, this);\n    }\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [combinedDescription && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginBottom: '20px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Image Analysis:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: combinedDescription\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 11\n      }, this), generatedStory && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [generatedStory.title && /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            color: '#FFB6C1',\n            marginTop: '20px',\n            marginBottom: '10px',\n            fontSize: '24px'\n          },\n          children: generatedStory.title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            color: '#87CEEB',\n            marginTop: '20px'\n          },\n          children: \"Generated Story:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#FFB6C1',\n            whiteSpace: 'pre-wrap',\n            lineHeight: '1.6',\n            marginTop: '10px'\n          },\n          children: generatedStory.story\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      minHeight: '100vh',\n      width: '100%',\n      background: 'black',\n      color: 'white',\n      padding: '20px',\n      boxSizing: 'border-box',\n      overflowX: 'hidden'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"link\", {\n      href: \"https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap\",\n      rel: \"stylesheet\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n      style: {\n        fontSize: 'clamp(2rem, 5vw, 3.5rem)',\n        fontWeight: 'bold',\n        margin: '1rem 0 3rem 0',\n        fontFamily: \"'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif\",\n        display: 'flex',\n        gap: '15px',\n        textAlign: 'center',\n        flexWrap: 'wrap',\n        justifyContent: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          color: '#87CEEB',\n          textShadow: `\n            0 0 1px #87CEEB,\n            0 0 2px #87CEEB,\n            0 0 21px #87CEEB,\n            0 0 30px #00BFFF,\n            0 0 50px #00BFFF\n          `\n        },\n        children: \"Story\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          color: 'white',\n          textShadow: `\n            0 0 1px #fff,\n            0 0 2px #fff,\n            0 0 21px #fff,\n            0 0 30px #fff,\n            0 0 50px #fff\n          `\n        },\n        children: \"Dashboard\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        flexDirection: 'row',\n        gap: '20px',\n        maxWidth: '1200px',\n        margin: '0 auto',\n        position: 'relative',\n        flexWrap: 'wrap'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          flexDirection: 'column',\n          gap: '10px',\n          minWidth: '140px',\n          flex: '0 0 auto',\n          position: 'sticky',\n          top: '20px',\n          alignSelf: 'flex-start',\n          '@media (max-width: 768px)': {\n            flexDirection: 'row',\n            position: 'static',\n            width: '100%',\n            flexWrap: 'wrap',\n            justifyContent: 'center'\n          }\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => navigate('/'),\n          style: {\n            padding: '0.6rem 1.2rem',\n            background: 'rgba(255, 192, 203, 0.15)',\n            color: '#ff69b4',\n            border: '2px solid #ff69b4',\n            borderRadius: '10px',\n            fontSize: '1.2rem',\n            fontWeight: '500',\n            cursor: 'pointer',\n            transition: 'all 0.3s ease',\n            boxShadow: '0 0 2px #ff69b4, 0 0 4px #ff69b4, 0 0 6px #ff1493',\n            textShadow: '0 0 1px #ff69b4, 0 0 2px #ff1493',\n            fontFamily: 'Quicksand, sans-serif',\n            letterSpacing: '0.5px',\n            width: '100%',\n            minWidth: '120px',\n            '@media (max-width: 768px)': {\n              width: 'auto',\n              flex: '1 1 auto'\n            }\n          },\n          children: \"Main Page\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setShowPopup(true),\n          style: {\n            padding: '0.6rem 1.2rem',\n            background: 'rgba(0, 191, 255, 0.15)',\n            color: '#00BFFF',\n            border: '2px solid #00BFFF',\n            borderRadius: '10px',\n            fontSize: '1.2rem',\n            fontWeight: '500',\n            cursor: 'pointer',\n            transition: 'all 0.3s ease',\n            boxShadow: '0 0 2px #00BFFF, 0 0 4px #00BFFF, 0 0 6px #1E90FF',\n            textShadow: '0 0 1px #00BFFF, 0 0 2px #1E90FF',\n            fontFamily: 'Quicksand, sans-serif',\n            letterSpacing: '0.5px',\n            width: '100%',\n            minWidth: '120px',\n            '@media (max-width: 768px)': {\n              width: 'auto',\n              flex: '1 1 auto'\n            }\n          },\n          children: \"Language\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleCreateStory,\n          style: {\n            padding: '0.6rem 1.2rem',\n            background: 'rgba(57, 255, 20, 0.15)',\n            color: '#39FF14',\n            border: '2px solid #39FF14',\n            borderRadius: '10px',\n            fontSize: '1.2rem',\n            fontWeight: '500',\n            cursor: isUploading ? 'not-allowed' : 'pointer',\n            transition: 'all 0.3s ease',\n            boxShadow: '0 0 2px #39FF14, 0 0 4px #39FF14, 0 0 6px #32CD32',\n            textShadow: '0 0 1px #39FF14, 0 0 2px #32CD32',\n            fontFamily: 'Quicksand, sans-serif',\n            letterSpacing: '0.5px',\n            opacity: isUploading ? 0.7 : 1,\n            width: '100%',\n            minWidth: '120px',\n            '@media (max-width: 768px)': {\n              width: 'auto',\n              flex: '1 1 auto'\n            }\n          },\n          disabled: isUploading,\n          children: isUploading ? 'Creating...' : 'Create Story'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 369,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          ref: fileInputRef,\n          onChange: handleFileSelect,\n          multiple: true,\n          accept: \"image/*\",\n          style: {\n            display: 'none'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 398,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleDeleteClick,\n          style: {\n            padding: '0.6rem 1.2rem',\n            background: isDeleteMode ? 'rgba(255, 68, 68, 0.25)' : 'rgba(255, 68, 68, 0.15)',\n            color: '#ff4444',\n            border: `2px solid ${isDeleteMode ? '#ff6666' : '#ff4444'}`,\n            borderRadius: '10px',\n            fontSize: '1.2rem',\n            fontWeight: '500',\n            cursor: 'pointer',\n            transition: 'all 0.3s ease',\n            boxShadow: isDeleteMode ? '0 0 10px rgba(255, 68, 68, 0.5)' : '0 0 2px #ff4444, 0 0 4px #ff4444, 0 0 6px #ff0000',\n            textShadow: '0 0 1px #ff4444, 0 0 2px #ff0000',\n            fontFamily: 'Quicksand, sans-serif',\n            letterSpacing: '0.5px',\n            width: '100%',\n            minWidth: '120px',\n            '@media (max-width: 768px)': {\n              width: 'auto',\n              flex: '1 1 auto'\n            }\n          },\n          children: isDeleteMode ? 'Confirm Delete' : 'Delete Story'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 407,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          flex: '1 1 auto',\n          minWidth: '0',\n          maxWidth: '800px',\n          background: 'rgba(0, 0, 0, 0.3)',\n          borderRadius: '20px',\n          padding: '20px',\n          border: '2px solid white',\n          boxShadow: '0 0 2px #fff, 0 0 4px #fff, 0 0 8px #fff, 0 0 16px #fff, 0 0 32px #fff',\n          position: 'relative',\n          overflowX: 'hidden',\n          overflowY: 'auto',\n          margin: '0 auto'\n        },\n        children: [showPopup && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: 'absolute',\n            top: '50%',\n            left: '50%',\n            transform: 'translate(-50%, -50%)',\n            background: 'rgba(0, 0, 0, 0.9)',\n            padding: '1.5rem 2.5rem',\n            borderRadius: '15px',\n            border: '2px solid #FFFF00',\n            color: '#FFFF00',\n            fontSize: '1.2rem',\n            fontFamily: 'Quicksand, sans-serif',\n            zIndex: 1000,\n            boxShadow: '0 0 5px #FFFF00, 0 0 10px #FFFF00, 0 0 15px #FFD700',\n            textShadow: '0 0 1px #FFFF00, 0 0 2px #FFD700',\n            animation: isFading ? 'popupFadeOut 0.3s ease-in-out forwards' : 'popupFadeIn 0.3s ease-in-out',\n            textAlign: 'center'\n          },\n          children: \"We only support Korean at this time.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 453,\n          columnNumber: 13\n        }, this), stories.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'center',\n            padding: '2rem',\n            color: 'rgba(255, 255, 255, 0.7)',\n            fontSize: '1.2rem',\n            fontFamily: 'Quicksand, sans-serif'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            style: {\n              color: '#FFB6C1',\n              marginBottom: '1rem',\n              textShadow: '0 0 10px rgba(255, 182, 193, 0.5)'\n            },\n            children: \"No stories yet\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 483,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Create your first story by clicking the \\\"Create Story\\\" button!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 488,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 476,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(StoryGrid, {\n            stories: stories,\n            isDeleteMode: isDeleteMode,\n            onStorySelect: handleStorySelect\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 492,\n            columnNumber: 15\n          }, this), renderDescription()]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n      children: `\n          @keyframes popupFadeIn {\n            from {\n              opacity: 0;\n              transform: translate(-50%, -60%);\n            }\n            to {\n              opacity: 1;\n              transform: translate(-50%, -50%);\n            }\n          }\n\n          @keyframes popupFadeOut {\n            from {\n              opacity: 1;\n              transform: translate(-50%, -50%);\n            }\n            to {\n              opacity: 0;\n              transform: translate(-50%, -40%);\n            }\n          }\n\n          @media (max-width: 768px) {\n            button {\n              min-width: 120px !important;\n              flex: 1 1 auto !important;\n            }\n          }\n\n          /* Custom scrollbar styles */\n          div::-webkit-scrollbar {\n            width: 8px;\n          }\n\n          div::-webkit-scrollbar-track {\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 4px;\n          }\n\n          div::-webkit-scrollbar-thumb {\n            background: rgba(255, 255, 255, 0.3);\n            border-radius: 4px;\n          }\n\n          div::-webkit-scrollbar-thumb:hover {\n            background: rgba(255, 255, 255, 0.5);\n          }\n        `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 503,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 238,\n    columnNumber: 5\n  }, this);\n};\n_s(CreateDiaryPage, \"BxdswwYkWqdR9kgL6KtAeHBD3Bc=\", false, function () {\n  return [useNavigate];\n});\n_c = CreateDiaryPage;\nexport default CreateDiaryPage;\nvar _c;\n$RefreshReg$(_c, \"CreateDiaryPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","StoryGrid","uploadImages","getAllStories","deleteStory","getImages","analyzeImagesSequentially","generateStory","createStory","jsxDEV","_jsxDEV","Fragment","_Fragment","CreateDiaryPage","_s","navigate","showPopup","setShowPopup","isFading","setIsFading","stories","setStories","isUploading","setIsUploading","uploadedImages","setUploadedImages","combinedDescription","setCombinedDescription","isAnalyzing","setIsAnalyzing","isGeneratingStory","setIsGeneratingStory","generatedStory","setGeneratedStory","fileInputRef","isDeleteMode","setIsDeleteMode","selectedStories","setSelectedStories","Set","isMobile","setIsMobile","checkMobile","window","matchMedia","matches","mediaQuery","addListener","removeListener","fetchStories","fetchImages","fetchedStories","error","console","images","log","fadeTimer","hideTimer","setTimeout","clearTimeout","handleCreateStory","_fileInputRef$current","current","click","handleFileSelect","event","files","target","length","Array","from","description","storyResult","title","story","imageUrls","map","img","image_path","storyId","story_id","value","handleDeleteStory","prev","filter","id","alert","handleStorySelect","newSelected","has","delete","add","handleDeleteClick","size","confirmDelete","confirm","forEach","renderDescription","children","fileName","_jsxFileName","lineNumber","columnNumber","style","marginBottom","color","marginTop","fontSize","whiteSpace","lineHeight","minHeight","width","background","padding","boxSizing","overflowX","href","rel","fontWeight","margin","fontFamily","display","gap","textAlign","flexWrap","justifyContent","textShadow","flexDirection","maxWidth","position","minWidth","flex","top","alignSelf","onClick","border","borderRadius","cursor","transition","boxShadow","letterSpacing","opacity","disabled","type","ref","onChange","multiple","accept","overflowY","left","transform","zIndex","animation","onStorySelect","_c","$RefreshReg$"],"sources":["/Users/hyunjunekim/Documents/GitHub/moment4u/src/pages/CreateDiaryPage.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport '../styles/global.css';\nimport { useNavigate } from 'react-router-dom';\nimport StoryGrid from '../components/StoryGrid';\nimport { \n  uploadImages, \n  getAllStories, \n  deleteStory, \n  Story, \n  ImageResponse, \n  getImages, \n  analyzeImagesSequentially,\n  generateStory,\n  StoryGenerationResponse,\n  createStory \n} from '../services/api';\n\nconst CreateDiaryPage: React.FC = () => {\n  const navigate = useNavigate();\n  const [showPopup, setShowPopup] = useState(false);\n  const [isFading, setIsFading] = useState(false);\n  const [stories, setStories] = useState<Story[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadedImages, setUploadedImages] = useState<ImageResponse[]>([]);\n  const [combinedDescription, setCombinedDescription] = useState<string>('');\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [isGeneratingStory, setIsGeneratingStory] = useState(false);\n  const [generatedStory, setGeneratedStory] = useState<StoryGenerationResponse | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [isDeleteMode, setIsDeleteMode] = useState(false);\n  const [selectedStories, setSelectedStories] = useState<Set<string>>(new Set());\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    const checkMobile = () => {\n      setIsMobile(window.matchMedia('(max-width: 768px)').matches);\n    };\n\n    // Initial check\n    checkMobile();\n\n    // Add listener for window resize\n    const mediaQuery = window.matchMedia('(max-width: 768px)');\n    mediaQuery.addListener(checkMobile);\n\n    // Cleanup\n    return () => mediaQuery.removeListener(checkMobile);\n  }, []);\n\n  useEffect(() => {\n    fetchStories();\n    fetchImages();\n  }, []);\n\n  const fetchStories = async () => {\n    try {\n      const fetchedStories = await getAllStories();\n      setStories(fetchedStories);\n    } catch (error) {\n      console.error('Failed to fetch stories:', error);\n    }\n  };\n\n  const fetchImages = async () => {\n    try {\n      const images = await getImages();\n      setUploadedImages(images);\n      console.log('Fetched images:', images);\n    } catch (error) {\n      console.error('Failed to fetch images:', error);\n    }\n  };\n\n  useEffect(() => {\n    let fadeTimer: NodeJS.Timeout;\n    let hideTimer: NodeJS.Timeout;\n    \n    if (showPopup) {\n      // Start fade out after 1.7 seconds\n      fadeTimer = setTimeout(() => {\n        setIsFading(true);\n      }, 1700);\n\n      // Hide popup after fade out animation (2 seconds + 0.3 seconds for fade out)\n      hideTimer = setTimeout(() => {\n        setShowPopup(false);\n        setIsFading(false);\n      }, 2000);\n    }\n\n    return () => {\n      clearTimeout(fadeTimer);\n      clearTimeout(hideTimer);\n    };\n  }, [showPopup]);\n\n  const handleCreateStory = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileSelect = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    if (!files || files.length === 0) return;\n\n    try {\n      setIsUploading(true);\n      const uploadedImages = await uploadImages(Array.from(files));\n      console.log('Successfully uploaded images:', uploadedImages);\n      setUploadedImages(uploadedImages);\n\n      // Start analyzing images\n      setIsAnalyzing(true);\n      const description = await analyzeImagesSequentially(uploadedImages);\n      setCombinedDescription(description);\n      setIsAnalyzing(false);\n\n      // Generate story\n      setIsGeneratingStory(true);\n      const storyResult = await generateStory(description);\n      setGeneratedStory(storyResult);\n      setIsGeneratingStory(false);\n\n      // Save the story\n      if (storyResult.title && storyResult.story && uploadedImages.length > 0) {\n        const imageUrls = uploadedImages.map(img => img.image_path);\n        const storyId = uploadedImages[0].story_id;\n        await createStory(storyResult.title, storyResult.story, imageUrls, storyId);\n        console.log('Story saved successfully!');\n      }\n    } catch (error) {\n      console.error('Failed to generate story:', error);\n      // Handle error appropriately\n    } finally {\n      setIsUploading(false);\n      if (event.target) {\n        event.target.value = ''; // Reset file input\n      }\n    }\n  };\n\n  const handleDeleteStory = async (storyId: string) => {\n    try {\n      await deleteStory(storyId);\n      setStories(prev => prev.filter(story => story.id !== storyId));\n    } catch (error) {\n      console.error('Failed to delete story:', error);\n      alert('Failed to delete story. Please try again.');\n    }\n  };\n\n  const handleStorySelect = (storyId: string) => {\n    setSelectedStories(prev => {\n      const newSelected = new Set(prev);\n      if (newSelected.has(storyId)) {\n        newSelected.delete(storyId);\n      } else {\n        newSelected.add(storyId);\n      }\n      return newSelected;\n    });\n  };\n\n  const handleDeleteClick = () => {\n    if (isDeleteMode) {\n      // If already in delete mode, perform deletion\n      if (selectedStories.size > 0) {\n        const confirmDelete = window.confirm(\n          `Are you sure you want to delete ${selectedStories.size} selected ${\n            selectedStories.size === 1 ? 'story' : 'stories'\n          }?`\n        );\n        \n        if (confirmDelete) {\n          selectedStories.forEach(async (storyId) => {\n            try {\n              await deleteStory(storyId);\n              // After successful deletion, you might want to refresh the stories list\n              // or remove the deleted story from the current list\n            } catch (error) {\n              console.error('Error deleting story:', error);\n              alert('Failed to delete story. Please try again.');\n            }\n          });\n          setSelectedStories(new Set());\n        }\n      }\n      setIsDeleteMode(false);\n    } else {\n      // Enter delete mode\n      setIsDeleteMode(true);\n    }\n  };\n\n  const renderDescription = () => {\n    if (isAnalyzing) {\n      return <p>Analyzing images...</p>;\n    }\n    if (isGeneratingStory) {\n      return <p>Generating story...</p>;\n    }\n    return (\n      <>\n        {combinedDescription && (\n          <div style={{ marginBottom: '20px' }}>\n            <h3>Image Analysis:</h3>\n            <p>{combinedDescription}</p>\n          </div>\n        )}\n        {generatedStory && (\n          <div>\n            {generatedStory.title && (\n              <h2 style={{ \n                color: '#FFB6C1',\n                marginTop: '20px',\n                marginBottom: '10px',\n                fontSize: '24px'\n              }}>\n                {generatedStory.title}\n              </h2>\n            )}\n            <h3 style={{ \n              color: '#87CEEB',\n              marginTop: '20px'\n            }}>Generated Story:</h3>\n            <p style={{\n              color: '#FFB6C1',\n              whiteSpace: 'pre-wrap',\n              lineHeight: '1.6',\n              marginTop: '10px'\n            }}>{generatedStory.story}</p>\n          </div>\n        )}\n      </>\n    );\n  };\n\n  return (\n    <div style={{\n      minHeight: '100vh',\n      width: '100%',\n      background: 'black',\n      color: 'white',\n      padding: '20px',\n      boxSizing: 'border-box',\n      overflowX: 'hidden'\n    }}>\n      <link href=\"https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap\" rel=\"stylesheet\" />\n      \n      {/* Title */}\n      <h1 style={{\n        fontSize: 'clamp(2rem, 5vw, 3.5rem)',\n        fontWeight: 'bold',\n        margin: '1rem 0 3rem 0',\n        fontFamily: \"'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif\",\n        display: 'flex',\n        gap: '15px',\n        textAlign: 'center',\n        flexWrap: 'wrap',\n        justifyContent: 'center',\n      }}>\n        <span style={{\n          color: '#87CEEB',\n          textShadow: `\n            0 0 1px #87CEEB,\n            0 0 2px #87CEEB,\n            0 0 21px #87CEEB,\n            0 0 30px #00BFFF,\n            0 0 50px #00BFFF\n          `,\n        }}>\n          Story\n        </span>\n        <span style={{\n          color: 'white',\n          textShadow: `\n            0 0 1px #fff,\n            0 0 2px #fff,\n            0 0 21px #fff,\n            0 0 30px #fff,\n            0 0 50px #fff\n          `,\n        }}>\n          Dashboard\n        </span>\n      </h1>\n\n      {/* Main Content Container */}\n      <div style={{\n        display: 'flex',\n        flexDirection: 'row',\n        gap: '20px',\n        maxWidth: '1200px',\n        margin: '0 auto',\n        position: 'relative',\n        flexWrap: 'wrap',\n      }}>\n        {/* Button Container */}\n        <div style={{\n          display: 'flex',\n          flexDirection: 'column',\n          gap: '10px',\n          minWidth: '140px',\n          flex: '0 0 auto',\n          position: 'sticky',\n          top: '20px',\n          alignSelf: 'flex-start',\n          '@media (max-width: 768px)': {\n            flexDirection: 'row',\n            position: 'static',\n            width: '100%',\n            flexWrap: 'wrap',\n            justifyContent: 'center',\n          }\n        }}>\n          <button\n            onClick={() => navigate('/')}\n            style={{\n              padding: '0.6rem 1.2rem',\n              background: 'rgba(255, 192, 203, 0.15)',\n              color: '#ff69b4',\n              border: '2px solid #ff69b4',\n              borderRadius: '10px',\n              fontSize: '1.2rem',\n              fontWeight: '500',\n              cursor: 'pointer',\n              transition: 'all 0.3s ease',\n              boxShadow: '0 0 2px #ff69b4, 0 0 4px #ff69b4, 0 0 6px #ff1493',\n              textShadow: '0 0 1px #ff69b4, 0 0 2px #ff1493',\n              fontFamily: 'Quicksand, sans-serif',\n              letterSpacing: '0.5px',\n              width: '100%',\n              minWidth: '120px',\n              '@media (max-width: 768px)': {\n                width: 'auto',\n                flex: '1 1 auto',\n              }\n            }}\n          >\n            Main Page\n          </button>\n\n          <button\n            onClick={() => setShowPopup(true)}\n            style={{\n              padding: '0.6rem 1.2rem',\n              background: 'rgba(0, 191, 255, 0.15)',\n              color: '#00BFFF',\n              border: '2px solid #00BFFF',\n              borderRadius: '10px',\n              fontSize: '1.2rem',\n              fontWeight: '500',\n              cursor: 'pointer',\n              transition: 'all 0.3s ease',\n              boxShadow: '0 0 2px #00BFFF, 0 0 4px #00BFFF, 0 0 6px #1E90FF',\n              textShadow: '0 0 1px #00BFFF, 0 0 2px #1E90FF',\n              fontFamily: 'Quicksand, sans-serif',\n              letterSpacing: '0.5px',\n              width: '100%',\n              minWidth: '120px',\n              '@media (max-width: 768px)': {\n                width: 'auto',\n                flex: '1 1 auto',\n              }\n            }}\n          >\n            Language\n          </button>\n\n          <button\n            onClick={handleCreateStory}\n            style={{\n              padding: '0.6rem 1.2rem',\n              background: 'rgba(57, 255, 20, 0.15)',\n              color: '#39FF14',\n              border: '2px solid #39FF14',\n              borderRadius: '10px',\n              fontSize: '1.2rem',\n              fontWeight: '500',\n              cursor: isUploading ? 'not-allowed' : 'pointer',\n              transition: 'all 0.3s ease',\n              boxShadow: '0 0 2px #39FF14, 0 0 4px #39FF14, 0 0 6px #32CD32',\n              textShadow: '0 0 1px #39FF14, 0 0 2px #32CD32',\n              fontFamily: 'Quicksand, sans-serif',\n              letterSpacing: '0.5px',\n              opacity: isUploading ? 0.7 : 1,\n              width: '100%',\n              minWidth: '120px',\n              '@media (max-width: 768px)': {\n                width: 'auto',\n                flex: '1 1 auto',\n              }\n            }}\n            disabled={isUploading}\n          >\n            {isUploading ? 'Creating...' : 'Create Story'}\n          </button>\n\n          <input\n            type=\"file\"\n            ref={fileInputRef}\n            onChange={handleFileSelect}\n            multiple\n            accept=\"image/*\"\n            style={{ display: 'none' }}\n          />\n\n          <button\n            onClick={handleDeleteClick}\n            style={{\n              padding: '0.6rem 1.2rem',\n              background: isDeleteMode ? 'rgba(255, 68, 68, 0.25)' : 'rgba(255, 68, 68, 0.15)',\n              color: '#ff4444',\n              border: `2px solid ${isDeleteMode ? '#ff6666' : '#ff4444'}`,\n              borderRadius: '10px',\n              fontSize: '1.2rem',\n              fontWeight: '500',\n              cursor: 'pointer',\n              transition: 'all 0.3s ease',\n              boxShadow: isDeleteMode ? \n                '0 0 10px rgba(255, 68, 68, 0.5)' :\n                '0 0 2px #ff4444, 0 0 4px #ff4444, 0 0 6px #ff0000',\n              textShadow: '0 0 1px #ff4444, 0 0 2px #ff0000',\n              fontFamily: 'Quicksand, sans-serif',\n              letterSpacing: '0.5px',\n              width: '100%',\n              minWidth: '120px',\n              '@media (max-width: 768px)': {\n                width: 'auto',\n                flex: '1 1 auto',\n              }\n            }}\n          >\n            {isDeleteMode ? 'Confirm Delete' : 'Delete Story'}\n          </button>\n        </div>\n\n        {/* Content Container */}\n        <div style={{\n          flex: '1 1 auto',\n          minWidth: '0',\n          maxWidth: '800px',\n          background: 'rgba(0, 0, 0, 0.3)',\n          borderRadius: '20px',\n          padding: '20px',\n          border: '2px solid white',\n          boxShadow: '0 0 2px #fff, 0 0 4px #fff, 0 0 8px #fff, 0 0 16px #fff, 0 0 32px #fff',\n          position: 'relative',\n          overflowX: 'hidden',\n          overflowY: 'auto',\n          margin: '0 auto',\n        }}>\n          {showPopup && (\n            <div style={{\n              position: 'absolute',\n              top: '50%',\n              left: '50%',\n              transform: 'translate(-50%, -50%)',\n              background: 'rgba(0, 0, 0, 0.9)',\n              padding: '1.5rem 2.5rem',\n              borderRadius: '15px',\n              border: '2px solid #FFFF00',\n              color: '#FFFF00',\n              fontSize: '1.2rem',\n              fontFamily: 'Quicksand, sans-serif',\n              zIndex: 1000,\n              boxShadow: '0 0 5px #FFFF00, 0 0 10px #FFFF00, 0 0 15px #FFD700',\n              textShadow: '0 0 1px #FFFF00, 0 0 2px #FFD700',\n              animation: isFading ? 'popupFadeOut 0.3s ease-in-out forwards' : 'popupFadeIn 0.3s ease-in-out',\n              textAlign: 'center',\n            }}>\n              We only support Korean at this time.\n            </div>\n          )}\n\n          {stories.length === 0 ? (\n            <div style={{\n              textAlign: 'center',\n              padding: '2rem',\n              color: 'rgba(255, 255, 255, 0.7)',\n              fontSize: '1.2rem',\n              fontFamily: 'Quicksand, sans-serif'\n            }}>\n              <h3 style={{\n                color: '#FFB6C1',\n                marginBottom: '1rem',\n                textShadow: '0 0 10px rgba(255, 182, 193, 0.5)'\n              }}>No stories yet</h3>\n              <p>Create your first story by clicking the \"Create Story\" button!</p>\n            </div>\n          ) : (\n            <>\n              <StoryGrid \n                stories={stories}\n                isDeleteMode={isDeleteMode}\n                onStorySelect={handleStorySelect}\n              />\n              {renderDescription()}\n            </>\n          )}\n        </div>\n      </div>\n\n      <style>\n        {`\n          @keyframes popupFadeIn {\n            from {\n              opacity: 0;\n              transform: translate(-50%, -60%);\n            }\n            to {\n              opacity: 1;\n              transform: translate(-50%, -50%);\n            }\n          }\n\n          @keyframes popupFadeOut {\n            from {\n              opacity: 1;\n              transform: translate(-50%, -50%);\n            }\n            to {\n              opacity: 0;\n              transform: translate(-50%, -40%);\n            }\n          }\n\n          @media (max-width: 768px) {\n            button {\n              min-width: 120px !important;\n              flex: 1 1 auto !important;\n            }\n          }\n\n          /* Custom scrollbar styles */\n          div::-webkit-scrollbar {\n            width: 8px;\n          }\n\n          div::-webkit-scrollbar-track {\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 4px;\n          }\n\n          div::-webkit-scrollbar-thumb {\n            background: rgba(255, 255, 255, 0.3);\n            border-radius: 4px;\n          }\n\n          div::-webkit-scrollbar-thumb:hover {\n            background: rgba(255, 255, 255, 0.5);\n          }\n        `}\n      </style>\n    </div>\n  );\n};\n\nexport default CreateDiaryPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}