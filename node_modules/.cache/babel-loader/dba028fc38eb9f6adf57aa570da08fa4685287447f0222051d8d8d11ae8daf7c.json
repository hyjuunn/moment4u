{"ast":null,"code":"var _jsxFileName = \"/Users/hyunjunekim/Documents/GitHub/moment4u/src/pages/CreateDiaryPage.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport '../styles/global.css';\nimport { useNavigate } from 'react-router-dom';\nimport StoryGrid from '../components/StoryGrid';\nimport { uploadImages, getAllStories, deleteStory, getImages, analyzeImagesSequentially, generateStory, createStory } from '../services/api';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst CreateDiaryPage = () => {\n  _s();\n  const navigate = useNavigate();\n  const [showPopup, setShowPopup] = useState(false);\n  const [isFading, setIsFading] = useState(false);\n  const [stories, setStories] = useState([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadedImages, setUploadedImages] = useState([]);\n  const [combinedDescription, setCombinedDescription] = useState('');\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [isGeneratingStory, setIsGeneratingStory] = useState(false);\n  const [generatedStory, setGeneratedStory] = useState(null);\n  const fileInputRef = useRef(null);\n  const [isDeleteMode, setIsDeleteMode] = useState(false);\n  const [selectedStories, setSelectedStories] = useState(new Set());\n  const [windowWidth, setWindowWidth] = useState(window.innerWidth);\n  useEffect(() => {\n    fetchStories();\n    fetchImages();\n  }, []);\n  useEffect(() => {\n    const handleResize = () => {\n      // Force a re-render on resize/zoom\n      setWindowWidth(window.innerWidth);\n    };\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n  const fetchStories = async () => {\n    try {\n      const fetchedStories = await getAllStories();\n      setStories(fetchedStories);\n    } catch (error) {\n      console.error('Failed to fetch stories:', error);\n    }\n  };\n  const fetchImages = async () => {\n    try {\n      const images = await getImages();\n      setUploadedImages(images);\n      console.log('Fetched images:', images);\n    } catch (error) {\n      console.error('Failed to fetch images:', error);\n    }\n  };\n  useEffect(() => {\n    let fadeTimer;\n    let hideTimer;\n    if (showPopup) {\n      // Start fade out after 1.7 seconds\n      fadeTimer = setTimeout(() => {\n        setIsFading(true);\n      }, 1700);\n\n      // Hide popup after fade out animation (2 seconds + 0.3 seconds for fade out)\n      hideTimer = setTimeout(() => {\n        setShowPopup(false);\n        setIsFading(false);\n      }, 2000);\n    }\n    return () => {\n      clearTimeout(fadeTimer);\n      clearTimeout(hideTimer);\n    };\n  }, [showPopup]);\n  const handleCreateStory = () => {\n    var _fileInputRef$current;\n    (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n  };\n  const handleFileSelect = async event => {\n    const files = event.target.files;\n    if (!files || files.length === 0) return;\n    try {\n      setIsUploading(true);\n      const uploadedImages = await uploadImages(Array.from(files));\n      console.log('Successfully uploaded images:', uploadedImages);\n      setUploadedImages(uploadedImages);\n\n      // Start analyzing images\n      setIsAnalyzing(true);\n      const description = await analyzeImagesSequentially(uploadedImages);\n      setCombinedDescription(description);\n      setIsAnalyzing(false);\n\n      // Generate story\n      setIsGeneratingStory(true);\n      const storyResult = await generateStory(description);\n      setGeneratedStory(storyResult);\n      setIsGeneratingStory(false);\n\n      // Save the story\n      if (storyResult.title && storyResult.story && uploadedImages.length > 0) {\n        const imageUrls = uploadedImages.map(img => img.image_path);\n        const storyId = uploadedImages[0].story_id;\n        await createStory(storyResult.title, storyResult.story, imageUrls, storyId);\n        console.log('Story saved successfully!');\n      }\n    } catch (error) {\n      console.error('Failed to generate story:', error);\n      // Handle error appropriately\n    } finally {\n      setIsUploading(false);\n      if (event.target) {\n        event.target.value = ''; // Reset file input\n      }\n    }\n  };\n  const handleStorySelect = storyId => {\n    setSelectedStories(prev => {\n      const newSelected = new Set(prev);\n      if (newSelected.has(storyId)) {\n        newSelected.delete(storyId);\n      } else {\n        newSelected.add(storyId);\n      }\n      return newSelected;\n    });\n  };\n  const handleDeleteClick = async () => {\n    if (isDeleteMode) {\n      // If already in delete mode, perform deletion\n      if (selectedStories.size > 0) {\n        const confirmDelete = window.confirm(`Are you sure you want to delete ${selectedStories.size} selected ${selectedStories.size === 1 ? 'story' : 'stories'}?`);\n        if (confirmDelete) {\n          try {\n            // Create an array to track failed deletions\n            const failedDeletions = [];\n\n            // Log the stories we're about to delete\n            console.log('Selected stories for deletion:', Array.from(selectedStories));\n            console.log('Current stories:', stories);\n\n            // Delete stories one by one to handle errors individually\n            for (const storyId of Array.from(selectedStories)) {\n              try {\n                console.log('Attempting to delete story with ID:', storyId);\n                await deleteStory(storyId);\n                console.log('Successfully deleted story from API:', storyId);\n\n                // Update stories list immediately after successful deletion\n                setStories(prev => {\n                  console.log('Updating stories list after deletion. Current:', prev);\n                  const updated = prev.filter(story => story.id !== storyId);\n                  console.log('Updated stories list:', updated);\n                  return updated;\n                });\n              } catch (error) {\n                console.error(`Failed to delete story ${storyId}:`, error);\n                failedDeletions.push(storyId);\n              }\n            }\n\n            // Clear selected stories regardless of success/failure\n            setSelectedStories(new Set());\n\n            // Show error message if any deletions failed\n            if (failedDeletions.length > 0) {\n              alert(`Failed to delete ${failedDeletions.length} stories. Please try again later.`);\n            }\n\n            // Refresh the stories list from the server\n            await fetchStories();\n          } catch (error) {\n            console.error('Error in delete operation:', error);\n            alert('An error occurred while deleting stories. Please try again.');\n          }\n        }\n      }\n      setIsDeleteMode(false);\n    } else {\n      // Enter delete mode\n      setIsDeleteMode(true);\n      setSelectedStories(new Set());\n    }\n  };\n  const renderDescription = () => {\n    if (isAnalyzing) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Analyzing images...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 14\n      }, this);\n    }\n    if (isGeneratingStory) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Generating story...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 14\n      }, this);\n    }\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [combinedDescription && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginBottom: '20px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Image Analysis:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: combinedDescription\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 11\n      }, this), generatedStory && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [generatedStory.title && /*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            color: '#FFB6C1',\n            marginTop: '20px',\n            marginBottom: '10px',\n            fontSize: '24px'\n          },\n          children: generatedStory.title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            color: '#87CEEB',\n            marginTop: '20px'\n          },\n          children: \"Generated Story:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#FFB6C1',\n            whiteSpace: 'pre-wrap',\n            lineHeight: '1.6',\n            marginTop: '10px'\n          },\n          children: generatedStory.story\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true);\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"link\", {\n      href: \"https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap\",\n      rel: \"stylesheet\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"page-title\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"title-story\",\n          children: \"Story\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"title-dashboard\",\n          children: \"Dashboard\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"content-wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => navigate('/'),\n            className: \"nav-button pink-button\",\n            children: \"Main Page\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setShowPopup(true),\n            className: \"nav-button blue-button\",\n            children: \"Language\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleCreateStory,\n            className: `nav-button green-button ${isUploading ? 'disabled' : ''}`,\n            disabled: isUploading,\n            children: isUploading ? 'Creating...' : 'Create Story'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            ref: fileInputRef,\n            onChange: handleFileSelect,\n            multiple: true,\n            accept: \"image/*\",\n            style: {\n              display: 'none'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 284,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleDeleteClick,\n            className: `nav-button red-button ${isDeleteMode ? 'active' : ''}`,\n            children: isDeleteMode ? 'Confirm Delete' : 'Delete Story'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"main-content\",\n          children: [showPopup && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `popup ${isFading ? 'fade-out' : ''}`,\n            children: \"We only support Korean at this time.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 15\n          }, this), stories.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"empty-state\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"No stories yet\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 309,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"Create your first story by clicking the \\\"Create Story\\\" button!\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(StoryGrid, {\n              stories: stories,\n              isDeleteMode: isDeleteMode,\n              onStorySelect: handleStorySelect\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 17\n            }, this), renderDescription()]\n          }, void 0, true)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n        children: `\n            .page-container {\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              min-height: 100vh;\n              width: 100%;\n              background: black;\n              color: white;\n              position: relative;\n              overflow: auto;\n              padding: 1rem;\n              box-sizing: border-box;\n            }\n\n            .page-title {\n              font-size: clamp(2rem, 5vw, 3.5rem);\n              font-weight: bold;\n              margin: 1rem 0 3rem 0;\n              font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n              display: flex;\n              gap: 15px;\n              text-align: center;\n              flex-wrap: wrap;\n              justify-content: center;\n            }\n\n            .title-story {\n              color: #87CEEB;\n              text-shadow: \n                0 0 1px #87CEEB,\n                0 0 2px #87CEEB,\n                0 0 21px #87CEEB,\n                0 0 30px #00BFFF,\n                0 0 50px #00BFFF;\n            }\n\n            .title-dashboard {\n              color: white;\n              text-shadow: \n                0 0 1px #fff,\n                0 0 2px #fff,\n                0 0 21px #fff,\n                0 0 30px #fff,\n                0 0 50px #fff;\n            }\n\n            .content-wrapper {\n              display: flex;\n              justify-content: center;\n              width: 100%;\n              max-width: 1200px;\n              margin: 0 auto;\n              padding: 0;\n              position: relative;\n              gap: 1rem;\n              box-sizing: border-box;\n            }\n\n            .button-container {\n              width: 140px;\n              margin-right: 1rem;\n              display: flex;\n              flex-direction: column;\n              gap: 1rem;\n              align-self: flex-start;\n              position: sticky;\n              top: 2rem;\n              flex-wrap: nowrap;\n              justify-content: flex-start;\n              box-sizing: border-box;\n            }\n\n            .nav-button {\n              padding: 0.6rem 1.2rem;\n              border-radius: 10px;\n              font-size: 1.2rem;\n              font-weight: 500;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              font-family: 'Quicksand', sans-serif;\n              letter-spacing: 0.5px;\n              width: 100%;\n            }\n\n            .pink-button {\n              background: rgba(255, 192, 203, 0.15);\n              color: #ff69b4;\n              border: 2px solid #ff69b4;\n              box-shadow: 0 0 2px #ff69b4, 0 0 4px #ff69b4, 0 0 6px #ff1493;\n              text-shadow: 0 0 1px #ff69b4, 0 0 2px #ff1493;\n            }\n\n            .blue-button {\n              background: rgba(0, 191, 255, 0.15);\n              color: #00BFFF;\n              border: 2px solid #00BFFF;\n              box-shadow: 0 0 2px #00BFFF, 0 0 4px #00BFFF, 0 0 6px #1E90FF;\n              text-shadow: 0 0 1px #00BFFF, 0 0 2px #1E90FF;\n            }\n\n            .green-button {\n              background: rgba(57, 255, 20, 0.15);\n              color: #39FF14;\n              border: 2px solid #39FF14;\n              box-shadow: 0 0 2px #39FF14, 0 0 4px #39FF14, 0 0 6px #32CD32;\n              text-shadow: 0 0 1px #39FF14, 0 0 2px #32CD32;\n            }\n\n            .red-button {\n              background: rgba(255, 68, 68, 0.15);\n              color: #ff4444;\n              border: 2px solid #ff4444;\n              box-shadow: 0 0 2px #ff4444, 0 0 4px #ff4444, 0 0 6px #ff0000;\n              text-shadow: 0 0 1px #ff4444, 0 0 2px #ff0000;\n            }\n\n            .red-button.active {\n              background: rgba(255, 68, 68, 0.25);\n              border-color: #ff6666;\n              box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);\n            }\n\n            .disabled {\n              opacity: 0.7;\n              cursor: not-allowed;\n            }\n\n            .nav-button:hover:not(.disabled):not(.active) {\n              transform: scale(1.05);\n              letter-spacing: 1px;\n            }\n\n            .pink-button:hover:not(.disabled) {\n              background: rgba(255, 192, 203, 0.25);\n              box-shadow: 0 0 3px #ff69b4, 0 0 6px #ff69b4, 0 0 9px #ff1493;\n            }\n\n            .blue-button:hover:not(.disabled) {\n              background: rgba(0, 191, 255, 0.25);\n              box-shadow: 0 0 3px #00BFFF, 0 0 6px #00BFFF, 0 0 9px #1E90FF;\n            }\n\n            .green-button:hover:not(.disabled) {\n              background: rgba(57, 255, 20, 0.25);\n              box-shadow: 0 0 3px #39FF14, 0 0 6px #39FF14, 0 0 9px #32CD32;\n            }\n\n            .red-button:hover:not(.active):not(.disabled) {\n              background: rgba(255, 68, 68, 0.25);\n              box-shadow: 0 0 3px #ff4444, 0 0 6px #ff4444, 0 0 9px #ff0000;\n            }\n\n            .main-content {\n              flex: 1;\n              max-width: 800px;\n              min-height: 60vh;\n              max-height: 75vh;\n              border-radius: 20px;\n              padding: 1.5rem;\n              box-shadow: \n                0 0 2px #fff,\n                0 0 4px #fff,\n                0 0 8px #fff,\n                0 0 16px #fff,\n                0 0 32px #fff;\n              border: 2px solid white;\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              margin-bottom: 2rem;\n              position: relative;\n              overflow-y: auto;\n              overflow-x: hidden;\n              scroll-behavior: smooth;\n              background-color: rgba(0, 0, 0, 0.3);\n              box-sizing: border-box;\n              width: 100%;\n            }\n\n            .popup {\n              position: absolute;\n              top: 50%;\n              left: 50%;\n              transform: translate(-50%, -50%);\n              background: rgba(0, 0, 0, 0.9);\n              padding: 1.5rem 2.5rem;\n              border-radius: 15px;\n              border: 2px solid #FFFF00;\n              color: #FFFF00;\n              font-size: 1.2rem;\n              font-family: 'Quicksand', sans-serif;\n              z-index: 1000;\n              box-shadow: 0 0 5px #FFFF00, 0 0 10px #FFFF00, 0 0 15px #FFD700;\n              text-shadow: 0 0 1px #FFFF00, 0 0 2px #FFD700;\n              animation: popupFadeIn 0.3s ease-in-out;\n              text-align: center;\n            }\n\n            .popup.fade-out {\n              animation: popupFadeOut 0.3s ease-in-out forwards;\n            }\n\n            .empty-state {\n              text-align: center;\n              padding: 2rem;\n              color: rgba(255, 255, 255, 0.7);\n              font-size: 1.2rem;\n              font-family: 'Quicksand', sans-serif;\n            }\n\n            .empty-state h3 {\n              color: #FFB6C1;\n              margin-bottom: 1rem;\n              text-shadow: 0 0 10px rgba(255, 182, 193, 0.5);\n            }\n\n            @media (max-width: 768px), (min-resolution: 1.25dppx) {\n              .content-wrapper {\n                flex-direction: column;\n                align-items: stretch;\n              }\n\n              .button-container {\n                width: 100%;\n                margin-right: 0;\n                margin-bottom: 3rem;\n                flex-direction: row;\n                flex-wrap: wrap;\n                position: relative;\n                justify-content: center;\n              }\n\n              .nav-button {\n                width: auto;\n                flex: 1 1 auto;\n                min-width: 120px;\n                max-width: calc(50% - 5px);\n              }\n\n              .main-content {\n                margin-top: 20px;\n                width: 100%;\n                max-width: none;\n              }\n            }\n\n            @keyframes popupFadeIn {\n              from {\n                opacity: 0;\n                transform: translate(-50%, -60%);\n              }\n              to {\n                opacity: 1;\n                transform: translate(-50%, -50%);\n              }\n            }\n\n            @keyframes popupFadeOut {\n              from {\n                opacity: 1;\n                transform: translate(-50%, -50%);\n              }\n              to {\n                opacity: 0;\n                transform: translate(-50%, -40%);\n              }\n            }\n\n            /* Custom scrollbar styles */\n            div::-webkit-scrollbar {\n              width: 8px;\n            }\n\n            div::-webkit-scrollbar-track {\n              background: rgba(255, 255, 255, 0.1);\n              border-radius: 4px;\n            }\n\n            div::-webkit-scrollbar-thumb {\n              background: rgba(255, 255, 255, 0.3);\n              border-radius: 4px;\n            }\n\n            div::-webkit-scrollbar-thumb:hover {\n              background: rgba(255, 255, 255, 0.5);\n            }\n          `\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n_s(CreateDiaryPage, \"HDzVcVOO8HLacQOTtNZXP675HEI=\", false, function () {\n  return [useNavigate];\n});\n_c = CreateDiaryPage;\nexport default CreateDiaryPage;\nvar _c;\n$RefreshReg$(_c, \"CreateDiaryPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","StoryGrid","uploadImages","getAllStories","deleteStory","getImages","analyzeImagesSequentially","generateStory","createStory","jsxDEV","_jsxDEV","Fragment","_Fragment","CreateDiaryPage","_s","navigate","showPopup","setShowPopup","isFading","setIsFading","stories","setStories","isUploading","setIsUploading","uploadedImages","setUploadedImages","combinedDescription","setCombinedDescription","isAnalyzing","setIsAnalyzing","isGeneratingStory","setIsGeneratingStory","generatedStory","setGeneratedStory","fileInputRef","isDeleteMode","setIsDeleteMode","selectedStories","setSelectedStories","Set","windowWidth","setWindowWidth","window","innerWidth","fetchStories","fetchImages","handleResize","addEventListener","removeEventListener","fetchedStories","error","console","images","log","fadeTimer","hideTimer","setTimeout","clearTimeout","handleCreateStory","_fileInputRef$current","current","click","handleFileSelect","event","files","target","length","Array","from","description","storyResult","title","story","imageUrls","map","img","image_path","storyId","story_id","value","handleStorySelect","prev","newSelected","has","delete","add","handleDeleteClick","size","confirmDelete","confirm","failedDeletions","updated","filter","id","push","alert","renderDescription","children","fileName","_jsxFileName","lineNumber","columnNumber","style","marginBottom","color","marginTop","fontSize","whiteSpace","lineHeight","href","rel","className","onClick","disabled","type","ref","onChange","multiple","accept","display","onStorySelect","_c","$RefreshReg$"],"sources":["/Users/hyunjunekim/Documents/GitHub/moment4u/src/pages/CreateDiaryPage.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport '../styles/global.css';\nimport { useNavigate } from 'react-router-dom';\nimport StoryGrid from '../components/StoryGrid';\nimport { \n  uploadImages, \n  getAllStories, \n  deleteStory, \n  Story, \n  ImageResponse, \n  getImages, \n  analyzeImagesSequentially,\n  generateStory,\n  StoryGenerationResponse,\n  createStory \n} from '../services/api';\n\nconst CreateDiaryPage: React.FC = () => {\n  const navigate = useNavigate();\n  const [showPopup, setShowPopup] = useState(false);\n  const [isFading, setIsFading] = useState(false);\n  const [stories, setStories] = useState<Story[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadedImages, setUploadedImages] = useState<ImageResponse[]>([]);\n  const [combinedDescription, setCombinedDescription] = useState<string>('');\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [isGeneratingStory, setIsGeneratingStory] = useState(false);\n  const [generatedStory, setGeneratedStory] = useState<StoryGenerationResponse | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [isDeleteMode, setIsDeleteMode] = useState(false);\n  const [selectedStories, setSelectedStories] = useState<Set<string>>(new Set());\n  const [windowWidth, setWindowWidth] = useState(window.innerWidth);\n\n  useEffect(() => {\n    fetchStories();\n    fetchImages();\n  }, []);\n\n  useEffect(() => {\n    const handleResize = () => {\n      // Force a re-render on resize/zoom\n      setWindowWidth(window.innerWidth);\n    };\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  const fetchStories = async () => {\n    try {\n      const fetchedStories = await getAllStories();\n      setStories(fetchedStories);\n    } catch (error) {\n      console.error('Failed to fetch stories:', error);\n    }\n  };\n\n  const fetchImages = async () => {\n    try {\n      const images = await getImages();\n      setUploadedImages(images);\n      console.log('Fetched images:', images);\n    } catch (error) {\n      console.error('Failed to fetch images:', error);\n    }\n  };\n\n  useEffect(() => {\n    let fadeTimer: NodeJS.Timeout;\n    let hideTimer: NodeJS.Timeout;\n    \n    if (showPopup) {\n      // Start fade out after 1.7 seconds\n      fadeTimer = setTimeout(() => {\n        setIsFading(true);\n      }, 1700);\n\n      // Hide popup after fade out animation (2 seconds + 0.3 seconds for fade out)\n      hideTimer = setTimeout(() => {\n        setShowPopup(false);\n        setIsFading(false);\n      }, 2000);\n    }\n\n    return () => {\n      clearTimeout(fadeTimer);\n      clearTimeout(hideTimer);\n    };\n  }, [showPopup]);\n\n  const handleCreateStory = () => {\n    fileInputRef.current?.click();\n  };\n\n  const handleFileSelect = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const files = event.target.files;\n    if (!files || files.length === 0) return;\n\n    try {\n      setIsUploading(true);\n      const uploadedImages = await uploadImages(Array.from(files));\n      console.log('Successfully uploaded images:', uploadedImages);\n      setUploadedImages(uploadedImages);\n\n      // Start analyzing images\n      setIsAnalyzing(true);\n      const description = await analyzeImagesSequentially(uploadedImages);\n      setCombinedDescription(description);\n      setIsAnalyzing(false);\n\n      // Generate story\n      setIsGeneratingStory(true);\n      const storyResult = await generateStory(description);\n      setGeneratedStory(storyResult);\n      setIsGeneratingStory(false);\n\n      // Save the story\n      if (storyResult.title && storyResult.story && uploadedImages.length > 0) {\n        const imageUrls = uploadedImages.map(img => img.image_path);\n        const storyId = uploadedImages[0].story_id;\n        await createStory(storyResult.title, storyResult.story, imageUrls, storyId);\n        console.log('Story saved successfully!');\n      }\n    } catch (error) {\n      console.error('Failed to generate story:', error);\n      // Handle error appropriately\n    } finally {\n      setIsUploading(false);\n      if (event.target) {\n        event.target.value = ''; // Reset file input\n      }\n    }\n  };\n\n  const handleStorySelect = (storyId: string) => {\n    setSelectedStories(prev => {\n      const newSelected = new Set(prev);\n      if (newSelected.has(storyId)) {\n        newSelected.delete(storyId);\n      } else {\n        newSelected.add(storyId);\n      }\n      return newSelected;\n    });\n  };\n\n  const handleDeleteClick = async () => {\n    if (isDeleteMode) {\n      // If already in delete mode, perform deletion\n      if (selectedStories.size > 0) {\n        const confirmDelete = window.confirm(\n          `Are you sure you want to delete ${selectedStories.size} selected ${\n            selectedStories.size === 1 ? 'story' : 'stories'\n          }?`\n        );\n        \n        if (confirmDelete) {\n          try {\n            // Create an array to track failed deletions\n            const failedDeletions: string[] = [];\n            \n            // Log the stories we're about to delete\n            console.log('Selected stories for deletion:', Array.from(selectedStories));\n            console.log('Current stories:', stories);\n            \n            // Delete stories one by one to handle errors individually\n            for (const storyId of Array.from(selectedStories)) {\n              try {\n                console.log('Attempting to delete story with ID:', storyId);\n                await deleteStory(storyId);\n                console.log('Successfully deleted story from API:', storyId);\n                \n                // Update stories list immediately after successful deletion\n                setStories(prev => {\n                  console.log('Updating stories list after deletion. Current:', prev);\n                  const updated = prev.filter(story => story.id !== storyId);\n                  console.log('Updated stories list:', updated);\n                  return updated;\n                });\n              } catch (error) {\n                console.error(`Failed to delete story ${storyId}:`, error);\n                failedDeletions.push(storyId);\n              }\n            }\n            \n            // Clear selected stories regardless of success/failure\n            setSelectedStories(new Set());\n            \n            // Show error message if any deletions failed\n            if (failedDeletions.length > 0) {\n              alert(`Failed to delete ${failedDeletions.length} stories. Please try again later.`);\n            }\n            \n            // Refresh the stories list from the server\n            await fetchStories();\n          } catch (error) {\n            console.error('Error in delete operation:', error);\n            alert('An error occurred while deleting stories. Please try again.');\n          }\n        }\n      }\n      setIsDeleteMode(false);\n    } else {\n      // Enter delete mode\n      setIsDeleteMode(true);\n      setSelectedStories(new Set());\n    }\n  };\n\n  const renderDescription = () => {\n    if (isAnalyzing) {\n      return <p>Analyzing images...</p>;\n    }\n    if (isGeneratingStory) {\n      return <p>Generating story...</p>;\n    }\n    return (\n      <>\n        {combinedDescription && (\n          <div style={{ marginBottom: '20px' }}>\n            <h3>Image Analysis:</h3>\n            <p>{combinedDescription}</p>\n          </div>\n        )}\n        {generatedStory && (\n          <div>\n            {generatedStory.title && (\n              <h2 style={{ \n                color: '#FFB6C1',\n                marginTop: '20px',\n                marginBottom: '10px',\n                fontSize: '24px'\n              }}>\n                {generatedStory.title}\n              </h2>\n            )}\n            <h3 style={{ \n              color: '#87CEEB',\n              marginTop: '20px'\n            }}>Generated Story:</h3>\n            <p style={{\n              color: '#FFB6C1',\n              whiteSpace: 'pre-wrap',\n              lineHeight: '1.6',\n              marginTop: '10px'\n            }}>{generatedStory.story}</p>\n          </div>\n        )}\n      </>\n    );\n  };\n\n  return (\n    <>\n      <link href=\"https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap\" rel=\"stylesheet\" />\n      <div className=\"page-container\">\n        <h1 className=\"page-title\">\n          <span className=\"title-story\">Story</span>\n          <span className=\"title-dashboard\">Dashboard</span>\n        </h1>\n\n        <div className=\"content-wrapper\">\n          {/* Button Container */}\n          <div className=\"button-container\">\n            <button\n              onClick={() => navigate('/')}\n              className=\"nav-button pink-button\"\n            >\n              Main Page\n            </button>\n            <button\n              onClick={() => setShowPopup(true)}\n              className=\"nav-button blue-button\"\n            >\n              Language\n            </button>\n            <button\n              onClick={handleCreateStory}\n              className={`nav-button green-button ${isUploading ? 'disabled' : ''}`}\n              disabled={isUploading}\n            >\n              {isUploading ? 'Creating...' : 'Create Story'}\n            </button>\n            <input\n              type=\"file\"\n              ref={fileInputRef}\n              onChange={handleFileSelect}\n              multiple\n              accept=\"image/*\"\n              style={{ display: 'none' }}\n            />\n            <button\n              onClick={handleDeleteClick}\n              className={`nav-button red-button ${isDeleteMode ? 'active' : ''}`}\n            >\n              {isDeleteMode ? 'Confirm Delete' : 'Delete Story'}\n            </button>\n          </div>\n\n          {/* Main Content Container */}\n          <div className=\"main-content\">\n            {showPopup && (\n              <div className={`popup ${isFading ? 'fade-out' : ''}`}>\n                We only support Korean at this time.\n              </div>\n            )}\n            {stories.length === 0 ? (\n              <div className=\"empty-state\">\n                <h3>No stories yet</h3>\n                <p>Create your first story by clicking the \"Create Story\" button!</p>\n              </div>\n            ) : (\n              <>\n                <StoryGrid \n                  stories={stories}\n                  isDeleteMode={isDeleteMode}\n                  onStorySelect={handleStorySelect}\n                />\n                {renderDescription()}\n              </>\n            )}\n          </div>\n        </div>\n\n        <style>\n          {`\n            .page-container {\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              min-height: 100vh;\n              width: 100%;\n              background: black;\n              color: white;\n              position: relative;\n              overflow: auto;\n              padding: 1rem;\n              box-sizing: border-box;\n            }\n\n            .page-title {\n              font-size: clamp(2rem, 5vw, 3.5rem);\n              font-weight: bold;\n              margin: 1rem 0 3rem 0;\n              font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n              display: flex;\n              gap: 15px;\n              text-align: center;\n              flex-wrap: wrap;\n              justify-content: center;\n            }\n\n            .title-story {\n              color: #87CEEB;\n              text-shadow: \n                0 0 1px #87CEEB,\n                0 0 2px #87CEEB,\n                0 0 21px #87CEEB,\n                0 0 30px #00BFFF,\n                0 0 50px #00BFFF;\n            }\n\n            .title-dashboard {\n              color: white;\n              text-shadow: \n                0 0 1px #fff,\n                0 0 2px #fff,\n                0 0 21px #fff,\n                0 0 30px #fff,\n                0 0 50px #fff;\n            }\n\n            .content-wrapper {\n              display: flex;\n              justify-content: center;\n              width: 100%;\n              max-width: 1200px;\n              margin: 0 auto;\n              padding: 0;\n              position: relative;\n              gap: 1rem;\n              box-sizing: border-box;\n            }\n\n            .button-container {\n              width: 140px;\n              margin-right: 1rem;\n              display: flex;\n              flex-direction: column;\n              gap: 1rem;\n              align-self: flex-start;\n              position: sticky;\n              top: 2rem;\n              flex-wrap: nowrap;\n              justify-content: flex-start;\n              box-sizing: border-box;\n            }\n\n            .nav-button {\n              padding: 0.6rem 1.2rem;\n              border-radius: 10px;\n              font-size: 1.2rem;\n              font-weight: 500;\n              cursor: pointer;\n              transition: all 0.3s ease;\n              font-family: 'Quicksand', sans-serif;\n              letter-spacing: 0.5px;\n              width: 100%;\n            }\n\n            .pink-button {\n              background: rgba(255, 192, 203, 0.15);\n              color: #ff69b4;\n              border: 2px solid #ff69b4;\n              box-shadow: 0 0 2px #ff69b4, 0 0 4px #ff69b4, 0 0 6px #ff1493;\n              text-shadow: 0 0 1px #ff69b4, 0 0 2px #ff1493;\n            }\n\n            .blue-button {\n              background: rgba(0, 191, 255, 0.15);\n              color: #00BFFF;\n              border: 2px solid #00BFFF;\n              box-shadow: 0 0 2px #00BFFF, 0 0 4px #00BFFF, 0 0 6px #1E90FF;\n              text-shadow: 0 0 1px #00BFFF, 0 0 2px #1E90FF;\n            }\n\n            .green-button {\n              background: rgba(57, 255, 20, 0.15);\n              color: #39FF14;\n              border: 2px solid #39FF14;\n              box-shadow: 0 0 2px #39FF14, 0 0 4px #39FF14, 0 0 6px #32CD32;\n              text-shadow: 0 0 1px #39FF14, 0 0 2px #32CD32;\n            }\n\n            .red-button {\n              background: rgba(255, 68, 68, 0.15);\n              color: #ff4444;\n              border: 2px solid #ff4444;\n              box-shadow: 0 0 2px #ff4444, 0 0 4px #ff4444, 0 0 6px #ff0000;\n              text-shadow: 0 0 1px #ff4444, 0 0 2px #ff0000;\n            }\n\n            .red-button.active {\n              background: rgba(255, 68, 68, 0.25);\n              border-color: #ff6666;\n              box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);\n            }\n\n            .disabled {\n              opacity: 0.7;\n              cursor: not-allowed;\n            }\n\n            .nav-button:hover:not(.disabled):not(.active) {\n              transform: scale(1.05);\n              letter-spacing: 1px;\n            }\n\n            .pink-button:hover:not(.disabled) {\n              background: rgba(255, 192, 203, 0.25);\n              box-shadow: 0 0 3px #ff69b4, 0 0 6px #ff69b4, 0 0 9px #ff1493;\n            }\n\n            .blue-button:hover:not(.disabled) {\n              background: rgba(0, 191, 255, 0.25);\n              box-shadow: 0 0 3px #00BFFF, 0 0 6px #00BFFF, 0 0 9px #1E90FF;\n            }\n\n            .green-button:hover:not(.disabled) {\n              background: rgba(57, 255, 20, 0.25);\n              box-shadow: 0 0 3px #39FF14, 0 0 6px #39FF14, 0 0 9px #32CD32;\n            }\n\n            .red-button:hover:not(.active):not(.disabled) {\n              background: rgba(255, 68, 68, 0.25);\n              box-shadow: 0 0 3px #ff4444, 0 0 6px #ff4444, 0 0 9px #ff0000;\n            }\n\n            .main-content {\n              flex: 1;\n              max-width: 800px;\n              min-height: 60vh;\n              max-height: 75vh;\n              border-radius: 20px;\n              padding: 1.5rem;\n              box-shadow: \n                0 0 2px #fff,\n                0 0 4px #fff,\n                0 0 8px #fff,\n                0 0 16px #fff,\n                0 0 32px #fff;\n              border: 2px solid white;\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              margin-bottom: 2rem;\n              position: relative;\n              overflow-y: auto;\n              overflow-x: hidden;\n              scroll-behavior: smooth;\n              background-color: rgba(0, 0, 0, 0.3);\n              box-sizing: border-box;\n              width: 100%;\n            }\n\n            .popup {\n              position: absolute;\n              top: 50%;\n              left: 50%;\n              transform: translate(-50%, -50%);\n              background: rgba(0, 0, 0, 0.9);\n              padding: 1.5rem 2.5rem;\n              border-radius: 15px;\n              border: 2px solid #FFFF00;\n              color: #FFFF00;\n              font-size: 1.2rem;\n              font-family: 'Quicksand', sans-serif;\n              z-index: 1000;\n              box-shadow: 0 0 5px #FFFF00, 0 0 10px #FFFF00, 0 0 15px #FFD700;\n              text-shadow: 0 0 1px #FFFF00, 0 0 2px #FFD700;\n              animation: popupFadeIn 0.3s ease-in-out;\n              text-align: center;\n            }\n\n            .popup.fade-out {\n              animation: popupFadeOut 0.3s ease-in-out forwards;\n            }\n\n            .empty-state {\n              text-align: center;\n              padding: 2rem;\n              color: rgba(255, 255, 255, 0.7);\n              font-size: 1.2rem;\n              font-family: 'Quicksand', sans-serif;\n            }\n\n            .empty-state h3 {\n              color: #FFB6C1;\n              margin-bottom: 1rem;\n              text-shadow: 0 0 10px rgba(255, 182, 193, 0.5);\n            }\n\n            @media (max-width: 768px), (min-resolution: 1.25dppx) {\n              .content-wrapper {\n                flex-direction: column;\n                align-items: stretch;\n              }\n\n              .button-container {\n                width: 100%;\n                margin-right: 0;\n                margin-bottom: 3rem;\n                flex-direction: row;\n                flex-wrap: wrap;\n                position: relative;\n                justify-content: center;\n              }\n\n              .nav-button {\n                width: auto;\n                flex: 1 1 auto;\n                min-width: 120px;\n                max-width: calc(50% - 5px);\n              }\n\n              .main-content {\n                margin-top: 20px;\n                width: 100%;\n                max-width: none;\n              }\n            }\n\n            @keyframes popupFadeIn {\n              from {\n                opacity: 0;\n                transform: translate(-50%, -60%);\n              }\n              to {\n                opacity: 1;\n                transform: translate(-50%, -50%);\n              }\n            }\n\n            @keyframes popupFadeOut {\n              from {\n                opacity: 1;\n                transform: translate(-50%, -50%);\n              }\n              to {\n                opacity: 0;\n                transform: translate(-50%, -40%);\n              }\n            }\n\n            /* Custom scrollbar styles */\n            div::-webkit-scrollbar {\n              width: 8px;\n            }\n\n            div::-webkit-scrollbar-track {\n              background: rgba(255, 255, 255, 0.1);\n              border-radius: 4px;\n            }\n\n            div::-webkit-scrollbar-thumb {\n              background: rgba(255, 255, 255, 0.3);\n              border-radius: 4px;\n            }\n\n            div::-webkit-scrollbar-thumb:hover {\n              background: rgba(255, 255, 255, 0.5);\n            }\n          `}\n        </style>\n      </div>\n    </>\n  );\n};\n\nexport default CreateDiaryPage; "],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAC1D,OAAO,sBAAsB;AAC7B,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,OAAOC,SAAS,MAAM,yBAAyB;AAC/C,SACEC,YAAY,EACZC,aAAa,EACbC,WAAW,EAGXC,SAAS,EACTC,yBAAyB,EACzBC,aAAa,EAEbC,WAAW,QACN,iBAAiB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAEzB,MAAMC,eAAyB,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACtC,MAAMC,QAAQ,GAAGf,WAAW,CAAC,CAAC;EAC9B,MAAM,CAACgB,SAAS,EAAEC,YAAY,CAAC,GAAGpB,QAAQ,CAAC,KAAK,CAAC;EACjD,MAAM,CAACqB,QAAQ,EAAEC,WAAW,CAAC,GAAGtB,QAAQ,CAAC,KAAK,CAAC;EAC/C,MAAM,CAACuB,OAAO,EAAEC,UAAU,CAAC,GAAGxB,QAAQ,CAAU,EAAE,CAAC;EACnD,MAAM,CAACyB,WAAW,EAAEC,cAAc,CAAC,GAAG1B,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAAC2B,cAAc,EAAEC,iBAAiB,CAAC,GAAG5B,QAAQ,CAAkB,EAAE,CAAC;EACzE,MAAM,CAAC6B,mBAAmB,EAAEC,sBAAsB,CAAC,GAAG9B,QAAQ,CAAS,EAAE,CAAC;EAC1E,MAAM,CAAC+B,WAAW,EAAEC,cAAc,CAAC,GAAGhC,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACiC,iBAAiB,EAAEC,oBAAoB,CAAC,GAAGlC,QAAQ,CAAC,KAAK,CAAC;EACjE,MAAM,CAACmC,cAAc,EAAEC,iBAAiB,CAAC,GAAGpC,QAAQ,CAAiC,IAAI,CAAC;EAC1F,MAAMqC,YAAY,GAAGnC,MAAM,CAAmB,IAAI,CAAC;EACnD,MAAM,CAACoC,YAAY,EAAEC,eAAe,CAAC,GAAGvC,QAAQ,CAAC,KAAK,CAAC;EACvD,MAAM,CAACwC,eAAe,EAAEC,kBAAkB,CAAC,GAAGzC,QAAQ,CAAc,IAAI0C,GAAG,CAAC,CAAC,CAAC;EAC9E,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAG5C,QAAQ,CAAC6C,MAAM,CAACC,UAAU,CAAC;EAEjE7C,SAAS,CAAC,MAAM;IACd8C,YAAY,CAAC,CAAC;IACdC,WAAW,CAAC,CAAC;EACf,CAAC,EAAE,EAAE,CAAC;EAEN/C,SAAS,CAAC,MAAM;IACd,MAAMgD,YAAY,GAAGA,CAAA,KAAM;MACzB;MACAL,cAAc,CAACC,MAAM,CAACC,UAAU,CAAC;IACnC,CAAC;IAEDD,MAAM,CAACK,gBAAgB,CAAC,QAAQ,EAAED,YAAY,CAAC;IAC/C,OAAO,MAAMJ,MAAM,CAACM,mBAAmB,CAAC,QAAQ,EAAEF,YAAY,CAAC;EACjE,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMF,YAAY,GAAG,MAAAA,CAAA,KAAY;IAC/B,IAAI;MACF,MAAMK,cAAc,GAAG,MAAM9C,aAAa,CAAC,CAAC;MAC5CkB,UAAU,CAAC4B,cAAc,CAAC;IAC5B,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAClD;EACF,CAAC;EAED,MAAML,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC9B,IAAI;MACF,MAAMO,MAAM,GAAG,MAAM/C,SAAS,CAAC,CAAC;MAChCoB,iBAAiB,CAAC2B,MAAM,CAAC;MACzBD,OAAO,CAACE,GAAG,CAAC,iBAAiB,EAAED,MAAM,CAAC;IACxC,CAAC,CAAC,OAAOF,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;IACjD;EACF,CAAC;EAEDpD,SAAS,CAAC,MAAM;IACd,IAAIwD,SAAyB;IAC7B,IAAIC,SAAyB;IAE7B,IAAIvC,SAAS,EAAE;MACb;MACAsC,SAAS,GAAGE,UAAU,CAAC,MAAM;QAC3BrC,WAAW,CAAC,IAAI,CAAC;MACnB,CAAC,EAAE,IAAI,CAAC;;MAER;MACAoC,SAAS,GAAGC,UAAU,CAAC,MAAM;QAC3BvC,YAAY,CAAC,KAAK,CAAC;QACnBE,WAAW,CAAC,KAAK,CAAC;MACpB,CAAC,EAAE,IAAI,CAAC;IACV;IAEA,OAAO,MAAM;MACXsC,YAAY,CAACH,SAAS,CAAC;MACvBG,YAAY,CAACF,SAAS,CAAC;IACzB,CAAC;EACH,CAAC,EAAE,CAACvC,SAAS,CAAC,CAAC;EAEf,MAAM0C,iBAAiB,GAAGA,CAAA,KAAM;IAAA,IAAAC,qBAAA;IAC9B,CAAAA,qBAAA,GAAAzB,YAAY,CAAC0B,OAAO,cAAAD,qBAAA,uBAApBA,qBAAA,CAAsBE,KAAK,CAAC,CAAC;EAC/B,CAAC;EAED,MAAMC,gBAAgB,GAAG,MAAOC,KAA0C,IAAK;IAC7E,MAAMC,KAAK,GAAGD,KAAK,CAACE,MAAM,CAACD,KAAK;IAChC,IAAI,CAACA,KAAK,IAAIA,KAAK,CAACE,MAAM,KAAK,CAAC,EAAE;IAElC,IAAI;MACF3C,cAAc,CAAC,IAAI,CAAC;MACpB,MAAMC,cAAc,GAAG,MAAMtB,YAAY,CAACiE,KAAK,CAACC,IAAI,CAACJ,KAAK,CAAC,CAAC;MAC5Db,OAAO,CAACE,GAAG,CAAC,+BAA+B,EAAE7B,cAAc,CAAC;MAC5DC,iBAAiB,CAACD,cAAc,CAAC;;MAEjC;MACAK,cAAc,CAAC,IAAI,CAAC;MACpB,MAAMwC,WAAW,GAAG,MAAM/D,yBAAyB,CAACkB,cAAc,CAAC;MACnEG,sBAAsB,CAAC0C,WAAW,CAAC;MACnCxC,cAAc,CAAC,KAAK,CAAC;;MAErB;MACAE,oBAAoB,CAAC,IAAI,CAAC;MAC1B,MAAMuC,WAAW,GAAG,MAAM/D,aAAa,CAAC8D,WAAW,CAAC;MACpDpC,iBAAiB,CAACqC,WAAW,CAAC;MAC9BvC,oBAAoB,CAAC,KAAK,CAAC;;MAE3B;MACA,IAAIuC,WAAW,CAACC,KAAK,IAAID,WAAW,CAACE,KAAK,IAAIhD,cAAc,CAAC0C,MAAM,GAAG,CAAC,EAAE;QACvE,MAAMO,SAAS,GAAGjD,cAAc,CAACkD,GAAG,CAACC,GAAG,IAAIA,GAAG,CAACC,UAAU,CAAC;QAC3D,MAAMC,OAAO,GAAGrD,cAAc,CAAC,CAAC,CAAC,CAACsD,QAAQ;QAC1C,MAAMtE,WAAW,CAAC8D,WAAW,CAACC,KAAK,EAAED,WAAW,CAACE,KAAK,EAAEC,SAAS,EAAEI,OAAO,CAAC;QAC3E1B,OAAO,CAACE,GAAG,CAAC,2BAA2B,CAAC;MAC1C;IACF,CAAC,CAAC,OAAOH,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACjD;IACF,CAAC,SAAS;MACR3B,cAAc,CAAC,KAAK,CAAC;MACrB,IAAIwC,KAAK,CAACE,MAAM,EAAE;QAChBF,KAAK,CAACE,MAAM,CAACc,KAAK,GAAG,EAAE,CAAC,CAAC;MAC3B;IACF;EACF,CAAC;EAED,MAAMC,iBAAiB,GAAIH,OAAe,IAAK;IAC7CvC,kBAAkB,CAAC2C,IAAI,IAAI;MACzB,MAAMC,WAAW,GAAG,IAAI3C,GAAG,CAAC0C,IAAI,CAAC;MACjC,IAAIC,WAAW,CAACC,GAAG,CAACN,OAAO,CAAC,EAAE;QAC5BK,WAAW,CAACE,MAAM,CAACP,OAAO,CAAC;MAC7B,CAAC,MAAM;QACLK,WAAW,CAACG,GAAG,CAACR,OAAO,CAAC;MAC1B;MACA,OAAOK,WAAW;IACpB,CAAC,CAAC;EACJ,CAAC;EAED,MAAMI,iBAAiB,GAAG,MAAAA,CAAA,KAAY;IACpC,IAAInD,YAAY,EAAE;MAChB;MACA,IAAIE,eAAe,CAACkD,IAAI,GAAG,CAAC,EAAE;QAC5B,MAAMC,aAAa,GAAG9C,MAAM,CAAC+C,OAAO,CAClC,mCAAmCpD,eAAe,CAACkD,IAAI,aACrDlD,eAAe,CAACkD,IAAI,KAAK,CAAC,GAAG,OAAO,GAAG,SAAS,GAEpD,CAAC;QAED,IAAIC,aAAa,EAAE;UACjB,IAAI;YACF;YACA,MAAME,eAAyB,GAAG,EAAE;;YAEpC;YACAvC,OAAO,CAACE,GAAG,CAAC,gCAAgC,EAAEc,KAAK,CAACC,IAAI,CAAC/B,eAAe,CAAC,CAAC;YAC1Ec,OAAO,CAACE,GAAG,CAAC,kBAAkB,EAAEjC,OAAO,CAAC;;YAExC;YACA,KAAK,MAAMyD,OAAO,IAAIV,KAAK,CAACC,IAAI,CAAC/B,eAAe,CAAC,EAAE;cACjD,IAAI;gBACFc,OAAO,CAACE,GAAG,CAAC,qCAAqC,EAAEwB,OAAO,CAAC;gBAC3D,MAAMzE,WAAW,CAACyE,OAAO,CAAC;gBAC1B1B,OAAO,CAACE,GAAG,CAAC,sCAAsC,EAAEwB,OAAO,CAAC;;gBAE5D;gBACAxD,UAAU,CAAC4D,IAAI,IAAI;kBACjB9B,OAAO,CAACE,GAAG,CAAC,gDAAgD,EAAE4B,IAAI,CAAC;kBACnE,MAAMU,OAAO,GAAGV,IAAI,CAACW,MAAM,CAACpB,KAAK,IAAIA,KAAK,CAACqB,EAAE,KAAKhB,OAAO,CAAC;kBAC1D1B,OAAO,CAACE,GAAG,CAAC,uBAAuB,EAAEsC,OAAO,CAAC;kBAC7C,OAAOA,OAAO;gBAChB,CAAC,CAAC;cACJ,CAAC,CAAC,OAAOzC,KAAK,EAAE;gBACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B2B,OAAO,GAAG,EAAE3B,KAAK,CAAC;gBAC1DwC,eAAe,CAACI,IAAI,CAACjB,OAAO,CAAC;cAC/B;YACF;;YAEA;YACAvC,kBAAkB,CAAC,IAAIC,GAAG,CAAC,CAAC,CAAC;;YAE7B;YACA,IAAImD,eAAe,CAACxB,MAAM,GAAG,CAAC,EAAE;cAC9B6B,KAAK,CAAC,oBAAoBL,eAAe,CAACxB,MAAM,mCAAmC,CAAC;YACtF;;YAEA;YACA,MAAMtB,YAAY,CAAC,CAAC;UACtB,CAAC,CAAC,OAAOM,KAAK,EAAE;YACdC,OAAO,CAACD,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;YAClD6C,KAAK,CAAC,6DAA6D,CAAC;UACtE;QACF;MACF;MACA3D,eAAe,CAAC,KAAK,CAAC;IACxB,CAAC,MAAM;MACL;MACAA,eAAe,CAAC,IAAI,CAAC;MACrBE,kBAAkB,CAAC,IAAIC,GAAG,CAAC,CAAC,CAAC;IAC/B;EACF,CAAC;EAED,MAAMyD,iBAAiB,GAAGA,CAAA,KAAM;IAC9B,IAAIpE,WAAW,EAAE;MACf,oBAAOlB,OAAA;QAAAuF,QAAA,EAAG;MAAmB;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC;IACnC;IACA,IAAIvE,iBAAiB,EAAE;MACrB,oBAAOpB,OAAA;QAAAuF,QAAA,EAAG;MAAmB;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC;IACnC;IACA,oBACE3F,OAAA,CAAAE,SAAA;MAAAqF,QAAA,GACGvE,mBAAmB,iBAClBhB,OAAA;QAAK4F,KAAK,EAAE;UAAEC,YAAY,EAAE;QAAO,CAAE;QAAAN,QAAA,gBACnCvF,OAAA;UAAAuF,QAAA,EAAI;QAAe;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eACxB3F,OAAA;UAAAuF,QAAA,EAAIvE;QAAmB;UAAAwE,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACzB,CACN,EACArE,cAAc,iBACbtB,OAAA;QAAAuF,QAAA,GACGjE,cAAc,CAACuC,KAAK,iBACnB7D,OAAA;UAAI4F,KAAK,EAAE;YACTE,KAAK,EAAE,SAAS;YAChBC,SAAS,EAAE,MAAM;YACjBF,YAAY,EAAE,MAAM;YACpBG,QAAQ,EAAE;UACZ,CAAE;UAAAT,QAAA,EACCjE,cAAc,CAACuC;QAAK;UAAA2B,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACnB,CACL,eACD3F,OAAA;UAAI4F,KAAK,EAAE;YACTE,KAAK,EAAE,SAAS;YAChBC,SAAS,EAAE;UACb,CAAE;UAAAR,QAAA,EAAC;QAAgB;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eACxB3F,OAAA;UAAG4F,KAAK,EAAE;YACRE,KAAK,EAAE,SAAS;YAChBG,UAAU,EAAE,UAAU;YACtBC,UAAU,EAAE,KAAK;YACjBH,SAAS,EAAE;UACb,CAAE;UAAAR,QAAA,EAAEjE,cAAc,CAACwC;QAAK;UAAA0B,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC1B,CACN;IAAA,eACD,CAAC;EAEP,CAAC;EAED,oBACE3F,OAAA,CAAAE,SAAA;IAAAqF,QAAA,gBACEvF,OAAA;MAAMmG,IAAI,EAAC,0EAA0E;MAACC,GAAG,EAAC;IAAY;MAAAZ,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eACzG3F,OAAA;MAAKqG,SAAS,EAAC,gBAAgB;MAAAd,QAAA,gBAC7BvF,OAAA;QAAIqG,SAAS,EAAC,YAAY;QAAAd,QAAA,gBACxBvF,OAAA;UAAMqG,SAAS,EAAC,aAAa;UAAAd,QAAA,EAAC;QAAK;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,eAC1C3F,OAAA;UAAMqG,SAAS,EAAC,iBAAiB;UAAAd,QAAA,EAAC;QAAS;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAChD,CAAC,eAEL3F,OAAA;QAAKqG,SAAS,EAAC,iBAAiB;QAAAd,QAAA,gBAE9BvF,OAAA;UAAKqG,SAAS,EAAC,kBAAkB;UAAAd,QAAA,gBAC/BvF,OAAA;YACEsG,OAAO,EAAEA,CAAA,KAAMjG,QAAQ,CAAC,GAAG,CAAE;YAC7BgG,SAAS,EAAC,wBAAwB;YAAAd,QAAA,EACnC;UAED;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eACT3F,OAAA;YACEsG,OAAO,EAAEA,CAAA,KAAM/F,YAAY,CAAC,IAAI,CAAE;YAClC8F,SAAS,EAAC,wBAAwB;YAAAd,QAAA,EACnC;UAED;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eACT3F,OAAA;YACEsG,OAAO,EAAEtD,iBAAkB;YAC3BqD,SAAS,EAAE,2BAA2BzF,WAAW,GAAG,UAAU,GAAG,EAAE,EAAG;YACtE2F,QAAQ,EAAE3F,WAAY;YAAA2E,QAAA,EAErB3E,WAAW,GAAG,aAAa,GAAG;UAAc;YAAA4E,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACvC,CAAC,eACT3F,OAAA;YACEwG,IAAI,EAAC,MAAM;YACXC,GAAG,EAAEjF,YAAa;YAClBkF,QAAQ,EAAEtD,gBAAiB;YAC3BuD,QAAQ;YACRC,MAAM,EAAC,SAAS;YAChBhB,KAAK,EAAE;cAAEiB,OAAO,EAAE;YAAO;UAAE;YAAArB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC5B,CAAC,eACF3F,OAAA;YACEsG,OAAO,EAAE1B,iBAAkB;YAC3ByB,SAAS,EAAE,yBAAyB5E,YAAY,GAAG,QAAQ,GAAG,EAAE,EAAG;YAAA8D,QAAA,EAElE9D,YAAY,GAAG,gBAAgB,GAAG;UAAc;YAAA+D,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC3C,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CAAC,eAGN3F,OAAA;UAAKqG,SAAS,EAAC,cAAc;UAAAd,QAAA,GAC1BjF,SAAS,iBACRN,OAAA;YAAKqG,SAAS,EAAE,SAAS7F,QAAQ,GAAG,UAAU,GAAG,EAAE,EAAG;YAAA+E,QAAA,EAAC;UAEvD;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CACN,EACAjF,OAAO,CAAC8C,MAAM,KAAK,CAAC,gBACnBxD,OAAA;YAAKqG,SAAS,EAAC,aAAa;YAAAd,QAAA,gBAC1BvF,OAAA;cAAAuF,QAAA,EAAI;YAAc;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAI,CAAC,eACvB3F,OAAA;cAAAuF,QAAA,EAAG;YAA8D;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAG,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAClE,CAAC,gBAEN3F,OAAA,CAAAE,SAAA;YAAAqF,QAAA,gBACEvF,OAAA,CAACT,SAAS;cACRmB,OAAO,EAAEA,OAAQ;cACjBe,YAAY,EAAEA,YAAa;cAC3BqF,aAAa,EAAExC;YAAkB;cAAAkB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAClC,CAAC,EACDL,iBAAiB,CAAC,CAAC;UAAA,eACpB,CACH;QAAA;UAAAE,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,eAEN3F,OAAA;QAAAuF,QAAA,EACG;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MAAW;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACI,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC;EAAA,eACN,CAAC;AAEP,CAAC;AAACvF,EAAA,CAxlBID,eAAyB;EAAA,QACZb,WAAW;AAAA;AAAAyH,EAAA,GADxB5G,eAAyB;AA0lB/B,eAAeA,eAAe;AAAC,IAAA4G,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}